@model KitsRequestsViewModel

@{
    ViewData["Title"] = "Equipment Requests";
    var isReadonly = Model.ExistingRequest != null;
}

<h2 class="text-left">@ViewData["Title"]</h2>

<div class="container">
    @if (isReadonly)
    {
        <div class="mb-3">
            <a href="@Url.Action("Index", "EquipmentKitManager")" class="btn btn-secondary btn-sm">
                ← Back to Equipment & Kit Manager
            </a>
        </div>
    }

    <div class="row">
        <div class="col-12">

            @if (isReadonly)
            {
                <div class="alert alert-warning" role="alert">
                    🛑 This equipment request has already been submitted and cannot be edited.
                </div>
            }
            else
            {
                <p class="text-left">
                    Please use the below form to submit your equipment request for the committee to review.
                </p>
                <p class="text-left">
                    Please ensure you know all the information required for a complete order before completing this form to ensure there are no delays between the club and the supplier.
                </p>
                <p class="text-left">
                    The team name will be based on your season 2025-2026 age level.
                </p>
            }
        </div>
    </div>

    <form id="teamForm" class="mt-3" enctype="multipart/form-data">
        <!-- Team dropdown -->
        <div class="row mb-3">
            <div class="col-md-6">
                <label class="form-label">Select Team</label>
                <select id="teamSelect" class="form-select" required @(isReadonly ? "disabled" : "")>
                    <option value="" disabled selected>Select Team</option>
                    @{
                        foreach (var team in Model.Teams.DistinctBy(t => t.Name))
                        {
                            var selected = Model.ExistingRequest?.TeamName == team.Name ? "selected=\"selected\"" : "";
                            @:<option value="@team.Name" @Html.Raw(selected)>@team.Name</option>
                        }
                    }
                </select>
                <div class="invalid-feedback">Please select a team.</div>
            </div>
        </div>

        <!-- Manager Details -->
        <div class="row mb-3">
            <div class="col-md-4">
                <div class="form-floating">
                    <input type="text" id="managerName" name="ManagerName" class="form-control" required
                           value="@(Model.ExistingRequest?.ManagerName ?? "")" @(isReadonly ? "readonly" : "")/>
                    <label>Manager Name</label>
                    <div class="invalid-feedback">Please enter the manager's name.</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-floating">
                    <input type="text" id="managerMobile" name="ManagerMobile" class="form-control" required
                           inputmode="numeric" pattern="[0-9]{11}" minlength="11" maxlength="11"
                           value="@(Model.ExistingRequest?.ManagerMobile ?? "")" @(isReadonly ? "readonly" : "")/>
                    <label>Manager Mobile No.</label>
                    <div class="invalid-feedback">Please enter an 11-digit mobile number (numbers only).</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-floating">
                    <input type="email" id="managerEmail" name="ManagerEmail" class="form-control" required
                           value="@(Model.ExistingRequest?.ManagerEmail ?? "")" @(isReadonly ? "readonly" : "")/>
                    <label>Manager Email</label>
                    <div class="invalid-feedback">Please enter a valid email address.</div>
                </div>
            </div>
        </div>

        <!-- Request Type -->


        @if (!isReadonly)
        {
            <div class="row mb-3">
                <div class="col-md-12">
                    <div class="form-floating">
                        <select id="Type" name="Type" class="form-select" @(isReadonly ? "disabled" : "")>
                            <option value="" disabled selected>Select Request Type</option>
                            <option value="New Team Equipment Order">New Team Equipment Order</option>
                            <option value="Annual Ball Refresh">Annual Ball Refresh</option>
                            <option value="Ball Size Increase">Ball Size Increase</option>
                            <option value="Bib Size Increase">Bib Size Increase</option>
                            <option value="First Aid Kit Replacement">First Aid Kit Replacement</option>
                            <option value="Miscellaneous">Miscellaneous request (including request for used balls, cones, bibs etc)</option>
                        </select>
                        <label for="Type">Request Type</label>
                    </div>
                </div>
            </div>
        }
        else
        {
            <div class="row mb-3">
                <div class="col-md-12">
                    <div class="form-floating">
                        <input id="Type" name="Type" class="form-control" required
                               value="@(Model.ExistingRequest?.Type ?? "")" @(isReadonly ? "readonly" : "")/>
                        <label for="Type">Request Type</label>
                    </div>
                </div>
            </div>
        }


        <!-- Additional Information -->
        <div class="row mb-3">
            <div class="col-md-12">
                <div class="form-floating">
                    <textarea id="additionalInfo" name="AdditionalInfo" class="form-control" style="height: 100px;" @(isReadonly ? "readonly" : "")>@(Model.ExistingRequest?.AdditionalInfo ?? "")</textarea>
                    <label>Additional Information About Request</label>
                </div>
            </div>
        </div>


        @if (!isReadonly)
        {
            <div class="row mt-3">
                <div class="col-md-3">
                    <button type="button" class="btn btn-primary w-100" onclick="submitRequest()">Submit Equipment Request</button>
                </div>
            </div>
        }

    </form>
</div>

<!-- Modal for Form Messages -->
<div class="modal fade" id="formMessageModal" tabindex="-1" aria-labelledby="formMessageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="formMessageModalLabel">Equipment Request</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="formMessageModalBody">
                <!-- Dynamic message will be injected here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>

<script src="~/js/equipmentrequests.js"></script>